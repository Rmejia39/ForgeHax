package dev.fiki.forgehax.main.mods.exploit;

import com.google.common.collect.Sets;
import dev.fiki.forgehax.api.event.SubscribeListener;
import dev.fiki.forgehax.api.mod.Category;
import dev.fiki.forgehax.api.mod.ToggleMod;
import dev.fiki.forgehax.api.modloader.RegisterMod;
import dev.fiki.forgehax.asm.events.packet.PacketInboundEvent;
import net.minecraft.network.play.server.SPlaySoundEffectPacket;
import net.minecraft.util.SoundEvent;
import net.minecraft.util.SoundEvents;

import java.util.Set;

@RegisterMod(
    name = "NoSoundLag",
    description = "lag exploit fix",
    category = Category.EXPLOIT
)
public class NoSoundLagMod extends ToggleMod {
  private static final Set<SoundEvent> BLACKLIST = Sets.newHashSet(
      SoundEvents.ARMOR_EQUIP_CHAIN,
      SoundEvents.ARMOR_EQUIP_DIAMOND,
      SoundEvents.ARMOR_EQUIP_ELYTRA,
      SoundEvents.ARMOR_EQUIP_GENERIC,
      SoundEvents.ARMOR_EQUIP_GOLD,
      SoundEvents.ARMOR_EQUIP_IRON,
      SoundEvents.ARMOR_EQUIP_LEATHER,
      SoundEvents.ARMOR_EQUIP_NETHERITE,
      SoundEvents.ARMOR_EQUIP_TURTLE
  );

  @SubscribeListener
  public void onPacketReceived(PacketInboundEvent event) {
    if (event.getPacket() instanceof SPlaySoundEffectPacket) {
      SPlaySoundEffectPacket packet = (SPlaySoundEffectPacket) event.getPacket();
      if (BLACKLIST.contains(packet.getSound())) {
        event.setCanceled(true);
      }
    }
  }
}
